<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>NexusOS 3.5 - PC Desktop</title>
    <style>
        :root { --blue: #00d4ff; --dark: #0a0a0c; --win: #1a1a1d; --taskbar: rgba(10, 10, 15, 0.9); }
        * { box-sizing: border-box; }
        body { margin:0; background:var(--dark); color:white; font-family:'Segoe UI', sans-serif; overflow:hidden; }
        
        /* Desktop */
        #desktop { 
            width:100vw; height:calc(100vh - 45px); 
            background: radial-gradient(circle, #1e1e2f, #050505);
            position:relative; padding: 20px; display: flex; flex-direction: column; flex-wrap: wrap; gap: 20px; align-content: flex-start;
        }

        /* App Icons on Desktop */
        .icon { 
            width:90px; height:100px; text-align:center; cursor:pointer; 
            border-radius: 8px; transition: 0.2s; padding: 10px;
        }
        .icon:hover { background: rgba(255,255,255,0.1); }
        .icon img { width:45px; height:45px; display: block; margin: 0 auto 5px; filter: drop-shadow(0 0 5px var(--blue)); }
        .icon span { font-size:12px; text-shadow: 1px 1px 3px black; overflow: hidden; display: block; }

        /* Windows */
        .window { position:absolute; background:var(--win); border:1px solid #333; border-radius:8px; display:none; flex-direction:column; box-shadow:0 15px 50px rgba(0,0,0,0.9); z-index:10; }
        .win-header { background:#25252b; padding:10px; cursor:move; display:flex; justify-content:space-between; font-size:12px; border-radius:8px 8px 0 0; }
        .win-body { flex-grow:1; position:relative; overflow:auto; padding: 10px; }
        
        /* Taskbar */
        #taskbar { 
            position:fixed; bottom:0; width:100%; height:45px; background:var(--taskbar); 
            display:flex; align-items:center; padding:0 10px; border-top:1px solid #333; z-index:1000;
            backdrop-filter: blur(10px);
        }
        .start-btn { background:var(--blue); color:black; padding:5px 15px; border-radius:4px; font-weight:bold; cursor:pointer; margin-right: 15px; }
        .clock { margin-left: auto; font-size: 13px; font-family: monospace; }

        /* Form Elements */
        textarea { width:100%; height:250px; background:#000; color:#0f0; border:1px solid #444; font-family:monospace; padding:10px; margin-bottom: 10px; }
        input { background: #222; border: 1px solid #444; color: white; padding: 5px; margin-bottom: 5px; width: 100%; }
        .btn { background:var(--blue); border:none; padding:10px; font-weight:bold; cursor:pointer; color: black; border-radius: 4px; }
    </style>
</head>
<body>

<div id="desktop">
    <div class="icon" onclick="openApp('dev-suite')">
        <img src="https://cdn-icons-png.flaticon.com/512/4248/4248443.png">
        <span>App Creator</span>
    </div>
    
    <div class="icon" onclick="document.getElementById('file-input').click()">
        <img src="https://cdn-icons-png.flaticon.com/512/2997/2997843.png">
        <span>Instalar .ujs</span>
    </div>
    <input type="file" id="file-input" style="display:none" onchange="importApp(event)">
</div>

<div id="dev-suite" class="window" style="width:500px; left:120px; top:50px;">
    <div class="win-header">Nexus Developer Suite <span onclick="closeApp('dev-suite')" style="cursor:pointer;color:red">✖</span></div>
    <div class="win-body">
        <label>Nombre de la App:</label>
        <input type="text" id="app-name" placeholder="Mi App">
        <label>URL del Icono (PNG):</label>
        <input type="text" id="app-icon-url" placeholder="https://cdn-icons-png.flaticon.com/512/888/888859.png">
        <textarea id="editor">// Código UJS
const app = {
    onLoad: function() {
        ui.createWindow({ title: "App Instalada", background: "#111" });
        ui.addText("t1", { text: "¡Funciona!", y: 50, fontSize: 24, color: "#fff" });
    }
};
app.onLoad();</textarea>
        <button class="btn" onclick="exportApp()">DESCARGAR E INSTALAR (.ujs)</button>
    </div>
</div>

<div id="runtime" class="window" style="width:350px; height:450px; left:650px; top:50px;">
    <div class="win-header"><span id="rt-title">Nexus Runtime</span> <span onclick="closeApp('runtime')" style="cursor:pointer;color:red">✖</span></div>
    <div id="web-content" class="win-body"></div>
</div>

<div id="taskbar">
    <div class="start-btn" onclick="alert('NexusOS 3.5 Menu')">NEXUS</div>
    <div id="open-apps-icons" style="display:flex; gap:10px;"></div>
    <div class="clock" id="clock">00:00:00</div>
</div>

<script>
// --- KERNEL CORE ---
const ui = {
    createWindow: function(cfg) {
        document.getElementById('rt-title').innerText = cfg.title;
        const container = document.getElementById('web-content');
        container.innerHTML = "";
        container.style.background = cfg.background || "#fff";
        openApp('runtime');
    },
    addText: function(id, cfg) {
        const t = document.createElement('div');
        t.id = id; t.innerText = cfg.text;
        t.style.cssText = `position:absolute; width:100%; text-align:center; top:${cfg.y}px; font-size:${cfg.fontSize}px; color:${cfg.color};`;
        document.getElementById('web-content').appendChild(t);
    },
    addWebView: function(id, cfg) {
        const f = document.createElement('iframe');
        f.style.cssText = `width:100%; height:100%; border:none;`;
        f.src = cfg.url;
        document.getElementById('web-content').appendChild(f);
    }
};

const sys = { exit: () => closeApp('runtime') };

// --- SYSTEM FUNCTIONS ---
function openApp(id) { document.getElementById(id).style.display = 'flex'; }
function closeApp(id) { document.getElementById(id).style.display = 'none'; }

// EXPORTAR APP CON METADATOS
function exportApp() {
    const name = document.getElementById('app-name').value || "Sin Nombre";
    const icon = document.getElementById('app-icon-url').value || "https://cdn-icons-png.flaticon.com/512/888/888859.png";
    const code = document.getElementById('editor').value;

    const fullFile = `/*METADATA:{"name":"${name}","icon":"${icon}"}*/\n${code}`;
    
    const blob = new Blob([fullFile], {type: 'text/javascript'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `${name.replace(/\s/g, '_')}.ujs`;
    a.click();
    
    // Instalar instantáneamente en el escritorio
    createDesktopIcon(name, icon, code);
}

// IMPORTAR ARCHIVO .UJS
function importApp(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        const content = e.target.result;
        const metaMatch = content.match(/\/\*METADATA:(.*)\*\//);
        if (metaMatch) {
            const meta = JSON.parse(metaMatch[1]);
            const code = content.split('*/')[1];
            createDesktopIcon(meta.name, meta.icon, code);
        }
    };
    reader.readAsText(file);
}

function createDesktopIcon(name, iconUrl, code) {
    const div = document.createElement('div');
    div.className = "icon";
    div.innerHTML = `<img src="${iconUrl}"><span>${name}</span>`;
    div.onclick = () => {
        try {
            const runner = new Function('ui', 'sys', code);
            runner(ui, sys);
        } catch(e) { alert("Error: " + e.message); }
    };
    document.getElementById('desktop').appendChild(div);
}

// Reloj de la Taskbar
setInterval(() => {
    document.getElementById('clock').innerText = new Date().toLocaleTimeString();
}, 1000);

// Drag System
document.querySelectorAll('.win-header').forEach(h => {
    h.onmousedown = (e) => {
        let w = h.parentElement;
        let ox = e.clientX - w.offsetLeft, oy = e.clientY - w.offsetTop;
        document.onmousemove = (e) => { w.style.left = (e.clientX - ox) + 'px'; w.style.top = (e.clientY - oy) + 'px'; };
        document.onmouseup = () => document.onmousemove = null;
    };
});
</script>
</body>
</html>
